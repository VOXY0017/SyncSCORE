
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper Functions
    function isSignedIn() {
      return request.auth != null;
    }

    // By default, deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }

    /**
     * SESSIONS
     * - Siapapun (bahkan anonim) dapat membuat sesi baru.
     * - Siapapun dapat membaca sesi (untuk bergabung atau melihat).
     * - Hanya pengguna yang terautentikasi yang dapat memperbarui sesi (misalnya, mengubah tema atau rotasi).
     */
    match /sessions/{sessionId} {
      allow read, create: if true;
      allow update: if isSignedIn();

      /**
       * PLAYERS
       * - Siapapun dapat menambahkan pemain baru ke sesi.
       * - Siapapun dapat melihat daftar pemain.
       * - Siapapun dapat memperbarui skor pemain atau menghapusnya.
       */
      match /players/{playerId} {
        allow read, write: if true;
      }
      
      /**
       * ROUNDS & SCORES
       * - Siapapun dapat membuat ronde baru dan menambahkan skor baru.
       * - Siapapun dapat membaca riwayat ronde dan skor.
       * - Siapapun dapat menghapus skor (untuk fitur undo).
       */
      match /rounds/{roundId} {
        allow read, create: if true;

        match /scores/{scoreId} {
          allow read, create, delete: if true;
        }
      }
    }
  }
}
